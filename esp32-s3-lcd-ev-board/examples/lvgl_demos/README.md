# LVGL Demos Example

An example used to run LVGL's demos on ESP32-S3-LCD-EV-BOARD. LVGL's internal demos include music player, widgets, stress and benchmark. What's more, the printer and tuner are generated by [Squareline](https://squareline.io/).

This example also shows three methods to avoid tearing effect. It uses two or more frame buffers based on LVGL **buffering modes**. For more information about this, please refer to LVGL [documents](https://docs.lvgl.io/master/porting/display.html?#buffering-modes).

## How to use example

Please first read the [User Guide](https://docs.espressif.com/projects/espressif-esp-dev-kits/en/latest/esp32s3/esp32-s3-lcd-ev-board/user_guide.html#esp32-s3-lcd-ev-board) of the ESP32-S3-LCD-EV-BOARD to learn about its software and hardware information.

### Hardware Required

* An ESP32-S3-LCD-EV-BOARD development board with subboard1(800x480) or subboard2(480x480)

### Configurations

Run `idf.py menuconfig` and go to `Board Support Package`:
* `BSP_LCD_SUB_BOARD`: Choose a LCD subboard according to hardware. Default use subboard1(800x480).
* More configurations see BSP's [README](https://github.com/espressif/esp-bsp/tree/master/esp32_s3_lcd_ev_board#bsp-esp32-s3-lcd-ev-board).

**Note**: When anti-tearing funciton is enabled, the screen does not support software rotation like calling `bsp_display_rotate()` or setting software rotation through LVGL.

### Build and Flash

1. The project configure PSRAM with Octal 80M by default. **For best performance**, please see [here](../../factory/README.md#idf-patch) to enable `PSRAM Octal 120M` feature. Then configure the project by the following commands:
    ```
    rm -rf build sdkconfig sdkconfig.old
    idf.py -D SDKCONFIG_DEFAULTS="sdkconfig.defaults;sdkconfig.defaults.psram_octal_120m" reconfigure
    ```
2. Run `idf.py -p PORT flash monitor` to build, flash and monitor the project.

(To exit the serial monitor, type ``Ctrl-]``.)

See the [Getting Started Guide](https://docs.espressif.com/projects/esp-idf/en/latest/get-started/index.html) for full steps to configure and use ESP-IDF to build projects.

## Performance Test

### Test Environment

|          Item          |                          Value                          |
| :--------------------: | :-----------------------------------------------------: |
| Configuration of PSRAM |                       Octal, 120M                       |
| Configuration of Flash |                        QIO, 120M                        |
|    Version of LVGL     |                         v8.3.0                          |
|   Test Demo of LVGL    |                      Music player                       |
|  Basic Configurations  | sdkconfig.defaults, sdkconfig.defaults.psram_octal_120m |

### Description of Buffering Mode

| Buffering Mode |                    Description                    |    Special Configurations     |
| :------------: | :-----------------------------------------------: | :---------------------------: |
|     Mode1      | One buffer with 100-line heights in internal SRAM |               *               |
|     Mode2      |   One buffer with frame-size in internal PSRAM    |  sdkconfig.test.psram_buffer  |
|     Mode3      |  Full-refresh with two frame-size PSRAM buffers   | sdkconfig.test.full_refresh_1 |
|     Mode4      |   Direct-mode with two frame-size PSRAM buffers   |  sdkconfig.test.direct_mode   |
|     Mode5      | Full-refresh with three frame-size PSRAM buffers  | sdkconfig.test.full_refresh_2 |

**Note:** To test the above modes, run the following commands to configure project (take `Mode4` as an example):
```
rm -rf build sdkconfig sdkconfig.old
idf.py -D SDKCONFIG_DEFAULTS="sdkconfig.defaults;sdkconfig.defaults.psram_octal_120m;sdkconfig.test.direct_mode" reconfigure
```

### Average FPS with 480x480

| Buffering Mode | Average FPS |
| :------------: | :---------: |
|     Mode1      |     30      |
|     Mode2      |     25      |
|     Mode3      |     24      |
|     Mode4      |     26      |
|     Mode5      |     30      |

### Average FPS with 800x480

| Buffering Mode | Average FPS |
| :------------: | :---------: |
|     Mode1      |     27      |
|     Mode2      |     21      |
|     Mode3      |     21      |
|     Mode4      |     23      |
|     Mode5      |     25      |

## Troubleshooting

* Program build failure
    * Error message with `error: static assertion failed: "FLASH and PSRAM Mode configuration are not supported"`: Please modify the combination configuration of Flash (in `Serial flasher config`) and PSRAM (in `SPI RAM config`) like below.
        |   Flash   |    PSRAM    |
        | :-------: | :---------: |
        | QIO, 80M  | Octal, 80M  |
        | QIO, 120M | Octal, 120M |
    * Error message with `error: 'esp_lcd_rgb_panel_config_t' has no member named 'num_fbs'`: Please update the branch (release/v5.0 or master) of ESP-IDF.
* Program upload failure
    * Hardware connection is not correct: run `idf.py -p PORT monitor`, and reboot your board to see if there are any output logs.
    * The baud rate for downloading is too high: lower your baud rate in the `menuconfig` menu, and try again.
    * Error message with `A fatal error occurred: Could not open /dev/ttyACM0, the port doesn't exist`: Please first make sure the development board connected, then make board into "Download Boot" by following steps:
        1. keep press "BOOT(SW2)" button
        2. short press "RST(SW1)" button
        3. release "BOOT(SW2)".
        4. upload program and reset

## Technical support and feedback

Please use the following feedback channels:

* For technical queries, go to the [esp32.com](https://esp32.com/) forum
* For a feature request or bug report, create a [GitHub issue](https://github.com/espressif/esp-dev-kits/issues)

We will get back to you as soon as possible.
